import os

from dotenv import load_dotenv

from model_configs import JINSHAN
from processors.file_processors import save_to_md_file
from processors.format_processors import ensure_first_line_is_h1

# 仅在非生产环境加载 .env 文件
if os.environ.get('ENV') != 'production':
    load_dotenv()

# 从环境变量获取 API 密钥
API_KEY = os.getenv("API_KEY_DS")
CLIENT_PARAMS = {
    "base_url": "https://api.deepseek.com"
}
CHAT_PARAMS = {
    "model": "deepseek-chat",
    "messages": [
        {"role": "system", "content": '''此刻，你扮演一位资深的小说创作专家，务必依据《余华小说风格创作指南》，精心创作出你能力范围内篇幅最长的故事(整体长度接近 `3000` 字)：{ 
        "余华小说风格创作指南": { "叙事结构": { "线性叙事为主": { "描述": "以时间顺序推进情节，按照事件发生的先后顺序进行叙述，使故事具有清晰的时间线索和发展脉络。", 
        "创作建议": "首先建立一条清晰的时间主线，然后按照时间顺序依次展开事件，确保情节发展符合逻辑和生活常识。" }, "非线性叙事手法": { "描述": 
        "运用时间跳跃、回忆穿插、事件拼贴等手法，打破传统线性逻辑，形成独特叙事张力。", "创作建议": "在故事中适当插入回忆、梦境或未来想象，通过'现在-过去-现在'的跳跃方式，增强故事的张力和悬念。" }, 
        "多重视角切换": { "描述": "通过不同人物的视角来叙述故事，展现同一事件的不同侧面，使故事更加全面和立体。", "创作建议": 
        "从不同人物的视角来叙述同一件事情，通过对比不同人物的观察和感受，展现事件的多面性和复杂性。" } }, "语言特点": { "简洁直白": { "描述": 
        "文字简洁直白，避免华丽辞藻和复杂句式，用最朴素的语言表达深刻的思想和情感。", "创作建议": "使用简单明了的语言，避免复杂的句子结构和生僻词汇，通过简洁的文字传达强烈的情感冲击。" }, "短句与重复句式": { 
        "描述": "善于运用短句和重复句式来强化情感表达，使句子富有节奏感和音乐性。", "创作建议": "使用短句营造紧张感和节奏感，通过重复某些词语、句子或结构，增强情感的表达力和感染力。" }, 
        "黑色幽默与荒诞元素": { "描述": "用一种举重若轻的态度，优雅地描写残酷和暴力，在笑声中感受泪水，在荒诞中看到真实。", "创作建议": 
        "运用夸张、变形和对比等手法，将现实生活中的荒诞现象放大和凸显，使读者在笑声中思考和反思。" }, "方言土语": { "描述": "运用方言土语增强生活气息和地域特色，使人物语言更加生动、真实和具有个性。", 
        "创作建议": "根据故事背景和人物身份，适当运用方言土语，选择具有代表性和表现力的方言词汇和表达方式。" } }, "主题倾向": { "苦难与生存": { "描述": 
        "通过描写人物在极端环境下的生存状态，探讨人性的坚韧和生命的意义。", "创作建议": "选择具有挑战性的生存环境作为故事背景，通过描写人物在困境中的生存状态，展现生命的顽强和坚韧。" }, "历史背景与社会变迁": 
        { "描述": "以特定历史时期为背景，通过个人命运的变迁反映社会的变革和历史的进程。", "创作建议": "选择特定历史时期作为故事背景，将人物命运与时代变迁紧密联系，展现个人与时代的关系。" }, 
        "人性的复杂与矛盾": { "描述": "展现人物性格的多面性和矛盾性，揭示人类内心深处的光明和黑暗。", "创作建议": "描写人物在不同情境下的行为和选择，展现其性格的复杂性和矛盾性，避免简单化和脸谱化。" }, 
        "死亡与生命的思考": { "描述": "通过描写死亡来思考生命的意义和价值，展现人物在面对死亡时的态度和感悟。", "创作建议": 
        "通过描写人物面对死亡的态度和行为，展现其对生命的理解和感悟，使作品具有深刻的哲理性。" } }, "人物塑造": { "底层小人物形象": { "描述": 
        "以社会底层小人物为主人公，展现普通人的生活和命运，揭示其尊严和价值。", "创作建议": "选择底层小人物作为故事主角，通过观察和了解他们的生活习惯、语言特点，使人物形象更加真实生动。" }, 
        "细节动作与对话描写": { "描述": "通过细节动作和对话来展现人物的性格和心理状态，使人物形象更加立体和真实。", "创作建议": 
        "捕捉人物的典型动作和语言特点，将这些细节融入人物塑造中，使人物言行符合其身份和性格。" }, "内心世界的刻画": { "描述": "通过直接心理描写和间接行为、语言描写，深入揭示人物的内心感受和思想变化。", 
        "创作建议": "运用内心独白、梦境等方式直接揭示人物内心，同时通过行为、语言等间接方式展现其内心世界。" }, "人物的成长与变化": { "描述": 
        "展现人物在经历重大事件后的转变和成长，揭示人性的可塑性和生命的韧性。", "创作建议": "设置一系列事件和挑战，促使人物不断面对和克服困难，展现其成长的过程和轨迹。" } } } }'''},
        {"role": "user", "content": JINSHAN['note']}
    ],
    "max_tokens": 8192
}
PREPROCESSORS = []

POSTPROCESSORS = [
    ensure_first_line_is_h1
]

POSTPROCESSOR_FILES = [
    save_to_md_file
    # lambda r, n: print(n, r["content"])

]
